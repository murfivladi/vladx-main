# Функция `запрос` в VladX

Функция `запрос` в VladX предоставляет возможность выполнять HTTP/HTTPS запросы к веб-сервисам и API. Это мощный инструмент для взаимодействия с внешними сервисами.

## Синтаксис

```javascript
запрос(url, опции)
```

## Параметры

### url (обязательный)
- **Тип**: строка
- **Описание**: URL-адрес, к которому будет отправлен запрос
- **Пример**: `"https://api.example.com/data"`

### опции (необязательный)
- **Тип**: объект
- **Описание**: Объект с параметрами запроса

## Опции запроса

### method
- **Тип**: строка
- **Значение по умолчанию**: `"GET"`
- **Описание**: HTTP метод запроса
- **Возможные значения**: `"GET"`, `"POST"`, `"PUT"`, `"DELETE"`, `"PATCH"`, `"HEAD"`, `"OPTIONS"`

### headers
- **Тип**: объект
- **Значение по умолчанию**: `{}`
- **Описание**: HTTP заголовки запроса
- **Пример**: `{ "Content-Type": "application/json", "Authorization": "Bearer token" }`

### body
- **Тип**: строка
- **Описание**: Тело запроса (используется с методами POST, PUT, PATCH)
- **Пример**: `'{"name": "Vlad", "age": 30}'`

### raw
- **Тип**: логический
- **Значение по умолчанию**: `ложь`
- **Описание**: Если `истина`, возвращает необработанный ответ с кодом статуса, заголовками и телом

## Возвращаемое значение

Функция возвращает промис, который разрешается в:

- **JSON объект** - если ответ является валидным JSON и опция `raw` не установлена
- **Строка** - если ответ не является JSON и опция `raw` не установлена
- **Объект с полями status, headers, body** - если опция `raw` установлена в `истина`

## Примеры использования

### Простой GET запрос

```javascript
# Получение данных с API
асинх функция получитьПользователей() {
    пусть ответ = ждать запрос("https://jsonplaceholder.typicode.com/users")
    вернуть ответ
}

# Использование
асинх функция основная() {
    попытка {
        пусть пользователи = ждать получитьПользователей()
        печать("Найдено пользователей: " + длина(пользователи))
    } перехват (ошибка) {
        печать("Ошибка: " + ошибка)
    }
}

основная()
```

### POST запрос с телом

```javascript
# Отправка данных
асинх функция создатьПользователя(данные) {
    пусть ответ = ждать запрос("https://jsonplaceholder.typicode.com/users", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: код(данные)  # код() - сериализует в JSON
    })
    вернуть ответ
}

# Использование
асинх функция основная() {
    пусть новыйПользователь = {
        имя: "Влад",
        email: "vlad@example.com"
    }
    
    пусть результат = ждать создатьПользователя(новыйПользователь)
    печать("Создан пользователь с ID: " + результат.id)
}

основная()
```

### Запрос с авторизацией

```javascript
# Запрос с токеном авторизации
асинх функция получитьДанные(токен) {
    пусть ответ = ждать запрос("https://api.example.com/protected", {
        method: "GET",
        headers: {
            "Authorization": "Bearer " + токен,
            "Content-Type": "application/json"
        }
    })
    вернуть ответ
}
```

### Получение необработанного ответа

```javascript
# Получение полного ответа
асинх функция получитьПолныйОтвет() {
    пусть ответ = ждать запрос("https://httpbin.org/get", {
        raw: истина
    })
    
    печать("Код статуса: " + ответ.status)
    печать("Заголовки: " + ответ.headers)
    печать("Тело: " + ответ.body)
}
```

### PUT запрос для обновления данных

```javascript
# Обновление данных
асинх функция обновитьПользователя(id, данные) {
    пусть ответ = ждать запрос("https://jsonplaceholder.typicode.com/users/" + id, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json"
        },
        body: код(данные)
    })
    вернуть ответ
}
```

### DELETE запрос

```javascript
# Удаление данных
асинх функция удалитьПользователя(id) {
    пусть ответ = ждать запрос("https://jsonplaceholder.typicode.com/users/" + id, {
        method: "DELETE"
    })
    вернуть ответ
}
```

## Обработка ошибок

```javascript
асинх функция безопасныйЗапрос(url) {
    попытка {
        пусть ответ = ждать запрос(url)
        вернуть ответ
    } перехват (ошибка) {
        печать("Ошибка запроса к " + url + ": " + ошибка)
        вернуть ничто
    }
}
```

## Примеры заголовков

```javascript
# Обычные заголовки
пусть опции = {
    headers: {
        "Content-Type": "application/json",
        "Accept": "application/json",
        "User-Agent": "VladX Client 1.0"
    }
}

# Заголовки с авторизацией
пусть опции = {
    headers: {
        "Authorization": "Bearer your-token-here",
        "X-API-Key": "your-api-key"
    }
}
```

## Примечания

- Функция `запрос` асинхронная, поэтому используйте `ждать` при вызове
- Поддерживаются как HTTP, так и HTTPS протоколы
- Автоматически обрабатывает JSON ответы
- При ошибках соединения или HTTP ошибках (4xx, 5xx) промис отклоняется
- Функция безопасна для использования в асинхронных контекстах

## Совместимость

Функция `запрос` доступна во всех версиях VladX 1.0.0 и выше, и не требует дополнительных зависимостей.